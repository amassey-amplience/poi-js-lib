!function(t,e){"function"==typeof define&&define.amd?define([],e(t)):"object"==typeof exports?module.exports=e(t):t.atomic=e(t)}("undefined"!=typeof global?global:this.window||this.global,function(t){"use strict";var e,a={},n=!!t.XMLHttpRequest&&!!t.JSON,s={type:"GET",url:null,data:{},callback:null,headers:{"Content-type":"application/x-www-form-urlencoded"},responseType:"text",withCredentials:!1},r=function(){for(var t={},e=0;e<arguments.length;e++){var a=arguments[e];!function(e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&("[object Object]"===Object.prototype.toString.call(e[a])?t[a]=r(!0,t[a],e[a]):t[a]=e[a])}(a)}return t},o=function(t){var a;if("text"!==e.responseType&&""!==e.responseType)return[t.response,t];try{a=JSON.parse(t.responseText)}catch(e){a=t.responseText}return[a,t]},i=function(t){if("string"==typeof t)return t;if(/application\/json/i.test(e.headers["Content-type"])||"[object Array]"===Object.prototype.toString.call(t))return JSON.stringify(t);var a=[];for(var n in t)t.hasOwnProperty(n)&&a.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return a.join("&")},l=function(){var t={success:function(){},error:function(){},always:function(){}},a={success:function(e){return t.success=e,a},error:function(e){return t.error=e,a},always:function(e){return t.always=e,a}},n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){var e=o(n);n.status>=200&&n.status<300?t.success.apply(t,e):t.error.apply(t,e),t.always.apply(t,e)}},n.open(e.type,e.url,!0),n.responseType=e.responseType;for(var s in e.headers)e.headers.hasOwnProperty(s)&&n.setRequestHeader(s,e.headers[s]);return e.withCredentials&&(n.withCredentials=!0),n.send(i(e.data)),a},c=function(){var a=t.document.getElementsByTagName("script")[0],n=t.document.createElement("script");e.data.callback=e.callback,n.src=e.url+(e.url.indexOf("?")+1?"&":"?")+i(e.data),a.parentNode.insertBefore(n,a),n.onload=function(){this.remove()}};return a.ajax=function(t){if(n)return e=r(s,t||{}),"jsonp"===e.type.toLowerCase()?c():l()},a}),window.POI=function(t){this.images=[],this.imgsLoaded=0,this.params=t,this.namedImagesData={},this.namedImages={}},window.POI.prototype={generateData:function(t){var e,a=this,n=a.getHotspots(t.data);if(null!==n){var s=a.findImg(t.img,a.params);e={dimensions:{width:t.data.width,height:t.data.height},$img:s,data:t.img,name:t.img.name,points:n,svg:null},a.images.push(e),a.namedImagesData[t.img.name]=e}a.imgsLoaded+=1,t.callback(e)},getImgData:function(t){for(var e=this,a=this.params.images,n=this.getWindowSize(),s=document.querySelectorAll("img."+this.params.imgClass),r=a.length-1;r>=0;r--)!function(){var o=r,i=a[o];if("*"===i.name)for(var l=s.length-1;l>=0;l--)!function(){var a=l,n=i,r=s[a],o=r.getAttribute("src"),c=o.split("/");if(c=c[c.length-1],e.namedImages[c])return!1;var u={name:c,hotspotCallbacks:n.hotspotCallbacks,areaCallbacks:n.areaCallbacks};u&&u.data?e.generateData({data:u.data,img:u,callback:function(e){t(e)}}):u&&e.namedImagesData[u.name]?t(e.namedImagesData[u.name]):atomic.ajax({url:e.params.domain+"/i/"+e.params.account+"/"+u.name+".json?metadata=true&func=amp.jsonReturn&v="+(new Date).getTime()}).success(function(a){e.generateData({data:a,img:u,callback:function(e){t(e)}})}).error(function(t){console.error("Image failed to load",t)})}();else a[o].breakpoints&&(i=a[o].breakpoints.find(function(t){var e=t.minWidth||0,a=t.maxWidth||2e3;return e<=n&&a>=n}),i&&!i.areaCallbacks&&(i.areaCallbacks=a[o].areaCallbacks),i&&!i.hotspotCallbacks&&(i.hotspotCallbacks=a[o].hotspotCallbacks)),i&&i.data?e.generateData({data:i.data,img:i,callback:function(e){t(e)}}):i&&e.namedImagesData[i.name]?t(e.namedImagesData[i.name]):atomic.ajax({url:e.params.domain+"/i/"+e.params.account+"/"+i.name+".json?metadata=true&func=amp.jsonReturn&v="+(new Date).getTime()}).success(function(a){e.generateData({data:a,img:i,callback:function(e){t(e)}})}).error(function(t){console.error("Image failed to load",t)})}()},findImg:function(t){var e=document.querySelectorAll("img."+this.params.imgClass),a=this.params.imgAttribute||"src",n=null,s=new RegExp(t.name),r=null;"*"===t.name&&(s=/[\s\S]+/g);for(var o=e.length-1;o>=0;o--){var i=e[o].parentNode;if(i&&"picture"===i.tagName.toLowerCase()){for(var l=i.children,c=l.length-1;c>=0;c--)if((r=l[c].getAttribute(a)?l[c].getAttribute(a).match(s):l[c].getAttribute("srcset").match(s))&&r.length>0){n=e[o];break}}else if((r=e[o].getAttribute(a).match(s))&&r.length>0){n=e[o];break}}return n},getHotspots:function(t){var e=null;t.constructor!==Array&&(t=[t]);for(var a=t.length-1;a>=0;a--)t[a]&&t[a].metadata&&t[a].metadata.hotSpots&&t[a].metadata.hotSpots.constructor===Object&&t[a].metadata.hotSpots.hotSpots&&t[a].metadata.hotSpots.hotSpots.constructor===Object&&t[a].metadata.hotSpots.hotSpots.list&&t[a].metadata.hotSpots.hotSpots.list.length>0&&(e=t[a].metadata.hotSpots.hotSpots.list);return e},iteratePoints:function(t){if(t){var e=this.hotspots(),a=this.areaInterest(),n=t.points;e.removeOthers(t);for(var s=n.length-1;s>=0;s--)n[s].points.constructor===Array?(a.hideOthers(n[s],t),a.create(n[s],t)):e.create(n[s],t)}},assignEvents:function(t,e,a,n){if(a&&a.length>0)for(var s=a.length-1;s>=0;s--)!function(){var r=a[s];r.target!==e&&"*"!==r.target||(t.addEventListener(r.action,function(t){r.callback(t,n)},!1),r.initCallback&&r.initCallback(n))}()},getWindowSize:function(){return document.documentElement.clientWidth},checkResizeSubscription:function(){for(var t,e=this.params.images,a=!1,n=this,s=e.length-1;s>=0;s--)if(e[s].name&&"*"!==e[s].name&&(n.namedImages[e[s].name]=!0),e[s].breakpoints&&e[s].breakpoints.length){a=!0;break}a&&(window.onresize=function(e){clearTimeout(t),t=setTimeout(function(){n.getImgData(function(t){n.iteratePoints(t)})},350)})},init:function(){var t=this;this.checkResizeSubscription(),this.getImgData(function(e){t.iteratePoints(e)})}},"object"==typeof exports&&(module.exports=POI),POI.prototype.dom={hasClass:function(t,e){return new RegExp("(\\s|^)"+e+"(\\s|$)").test(t.className)},getClosest:function(t,e){var a,n,s=e.charAt(0),r="classList"in document.documentElement;for("["===s&&(e=e.substr(1,e.length-2),a=e.split("="),a.length>1&&(n=!0,a[1]=a[1].replace(/"/g,"").replace(/'/g,"")));t&&t!==document&&1===t.nodeType;t=t.parentNode){if("."===s)if(r){if(t.classList.contains(e.substr(1)))return t}else if(new RegExp("(^|\\s)"+e.substr(1)+"(\\s|$)").test(t.className))return t;if("#"===s&&t.id===e.substr(1))return t;if("["===s&&t.hasAttribute(a[0])){if(!n)return t;if(t.getAttribute(a[0])===a[1])return t}if(t.tagName.toLowerCase()===e)return t}return null}},POI.prototype.hotspots=function(){var t=this;return{create:function(e,a){var n=a.data.hotspotCallbacks,s=document.createElement("div"),r=e.selector,o=e.target;if(!r)return void console.warn("no selector specified");0===r.indexOf(".")?(r=r.slice(1),s.setAttribute("class",r)):0===r.indexOf("#")?(r=r.slice(1),s.setAttribute("id",r)):s.setAttribute("class",r);var i=t.dom.getClosest(a.$img,"."+t.params.containerClass);if(s.setAttribute("data-type","poi-hotspot"),i&&t.dom.hasClass(i,t.params.containerClass)){var l=e.points.x.toString().slice(2);l=l.substr(0,2)+"."+l.substr(2);var c=e.points.y.toString().slice(2);c=c.substr(0,2)+"."+c.substr(2),s.style.position="absolute",s.style.left=l+"%",s.style.top=c+"%",s.setAttribute("data-name",a.name),i.style.position="relative",i.appendChild(s),o&&o.length>0&&(s.setAttribute("data-target",o),t.assignEvents(s,o,n,{$image:a.$img,$target:s,$parent:i,hotspot:e,imgInfo:a}))}else console.warn("No parent with specified className "+t.params.containerClass+" was found.")},removeOthers:function(e){for(var a=t.dom.getClosest(e.$img,"."+t.params.containerClass),n=a.querySelectorAll('[data-type="poi-hotspot"]'),s=n.length-1;s>=0;s--)a.removeChild(n[s])}}},POI.prototype.areaInterest=function(){var t=this;return{create:function(e,a){var n=a.data.areaCallbacks,s=e.selector;if(!s)return void console.warn("no selector specified");var r,o=e.target,i=t.dom.getClosest(a.$img,"."+t.params.containerClass),l="http://www.w3.org/2000/svg",c=document.createElementNS(l,"g"),u=document.createElementNS(l,"polygon");if(a.svg?r=a.svg:(r=document.createElementNS(l,"svg"),r.setAttributeNS(null,"viewBox","0 0 "+a.dimensions.width+" "+a.dimensions.height),r.setAttributeNS(null,"data-name",a.name),i.appendChild(r),a.svg=r),0===s.indexOf(".")?(s=s.slice(1),u.setAttributeNS(null,"class",s)):0===s.indexOf("#")?(s=s.slice(1),u.setAttributeNS(null,"id",s)):u.setAttributeNS(null,"class",s),i&&t.dom.hasClass(i,t.params.containerClass)){var m="";e.points.forEach(function(t){m+=a.dimensions.width*t.x+","+a.dimensions.height*t.y+" "}),u.setAttributeNS(null,"points",m),r.appendChild(c),c.appendChild(u),o&&o.length>0&&(u.setAttributeNS(null,"data-target",o),t.assignEvents(c,o,n,{$image:a.$img,$target:c,$parent:i,area:e,imgInfo:a}))}else console.warn("No parent with specified className "+t.params.containerClass+" was found.")},hideOthers:function(e,a){for(var n=t.dom.getClosest(a.$img,"."+t.params.containerClass),s=n.getElementsByTagName("svg"),r=s.length-1;r>=0;r--)s[r].getAttribute("data-name")===a.name?s[r].style.display="block":s[r].style.display="none"}}};